<Window x:Class="AntennasCalculator.WpfApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:AntennasCalculator.WpfApp.ViewModels"
        xmlns:m="clr-namespace:Mapsui.UI.Wpf;assembly=Mapsui.UI.Wpf"
        xmlns:c="clr-namespace:AntennasCalculator.WpfApp.Controls"
        xmlns:conv="clr-namespace:AntennasCalculator.WpfApp.Converters"
        Title="Antennas Calculator"
        Height="720"
        Width="1100">

    <Window.Resources>
        <conv:EqualsToBoolConverter x:Key="EqualsToBool" />
        <conv:BoolToBrushConverter x:Key="BoolToBrush" />
        <conv:BoolToStatusConverter x:Key="BoolToStatus" />
    </Window.Resources>
    <Window.DataContext>
        <vm:LinkViewModel />
    </Window.DataContext>
    <!-- Horizontal split: top (map/profile), bottom (parameters like on screenshot) -->
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <!-- top: map/profile -->
            <RowDefinition Height="5" />
            <!-- splitter -->
            <RowDefinition Height="Auto" />
            <!-- bottom: parameters -->
        </Grid.RowDefinitions>

        <!-- TOP PANEL (currently the map; later can switch to profile view) -->
        <Border Grid.Row="0"
                BorderBrush="#DDD"
                BorderThickness="0,0,0,1">
            <TabControl x:Name="TopTabs"
                        Margin="0"
                        Padding="0">
                <TabItem Header="Map">
                    <Grid>
                        <m:MapControl x:Name="MapCtrl" />
                    </Grid>
                </TabItem>
                <TabItem Header="Profile">
                    <Grid>
                        <c:ProfileView x:Name="Profile"
                                       ProfileMode="{Binding ProfileMode}" />
                    </Grid>
                </TabItem>
            </TabControl>
        </Border>

        <!-- SPLITTER -->
        <GridSplitter Grid.Row="1"
                      Height="5"
                      HorizontalAlignment="Stretch"
                      Background="#EEE" />

        <!-- BOTTOM PANEL: controls similar to the screenshot (placeholder, non-breaking) -->
        <Border Grid.Row="2"
                Padding="8"
                Background="#F8F8F8"
                BorderBrush="#DDD"
                BorderThickness="1,0,0,0">
            <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                          VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- Row 1: Frequency bands -->
                    <StackPanel Orientation="Horizontal"
                                Margin="0,0,0,8">
                        <TextBlock Text="Frequency:"
                                   Width="90"
                                   VerticalAlignment="Center" />
                        <UniformGrid Columns="6"
                                     Margin="8,0,0,0">
                            <RadioButton Content="900 MHz"
                                         GroupName="BandGroup"
                                         IsChecked="{Binding Band, Converter={StaticResource EqualsToBool}, ConverterParameter='900 MHz'}" />
                            <RadioButton Content="2.4 GHz"
                                         GroupName="BandGroup"
                                         IsChecked="{Binding Band, Converter={StaticResource EqualsToBool}, ConverterParameter='2.4 GHz'}" />
                            <RadioButton Content="3 GHz"
                                         GroupName="BandGroup"
                                         IsChecked="{Binding Band, Converter={StaticResource EqualsToBool}, ConverterParameter='3 GHz'}" />
                            <RadioButton Content="4 GHz"
                                         GroupName="BandGroup"
                                         IsChecked="{Binding Band, Converter={StaticResource EqualsToBool}, ConverterParameter='4 GHz'}" />
                            <RadioButton Content="5 GHz"
                                         GroupName="BandGroup"
                                         IsChecked="{Binding Band, Converter={StaticResource EqualsToBool}, ConverterParameter='5 GHz'}" />
                            <RadioButton Content="11 GHz"
                                         GroupName="BandGroup"
                                         IsChecked="{Binding Band, Converter={StaticResource EqualsToBool}, ConverterParameter='11 GHz'}" />
                        </UniformGrid>
                    </StackPanel>

                    <!-- Row 2: Numeric frequency + clearance that we already use in code-behind -->
                    <StackPanel Orientation="Horizontal"
                                Margin="0,0,0,8">
                        <TextBlock Text="Freq (GHz):"
                                   VerticalAlignment="Center" />
                        <TextBox x:Name="FreqGHzBox"
                                 Width="80"
                                 Text="{Binding FreqGHz, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="6,0,12,0" />
                        <TextBlock Text="Clearance (% of 1st zone):"
                                   VerticalAlignment="Center" />
                        <TextBox x:Name="ClearancePctBox"
                                 Width="60"
                                 Text="{Binding ClearancePct, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="6,0,12,0" />
                        <Button Content="Compute &amp; Draw"
                                Click="ComputeBtn_Click"
                                Margin="0,0,6,0" />
                        <Button Content="Clear"
                                Click="ClearBtn_Click" />
                    </StackPanel>

                    <!-- Row 3: Technology -->
                    <StackPanel Orientation="Horizontal"
                                Margin="0,0,0,8">
                        <TextBlock Text="Technology:"
                                   Width="90"
                                   VerticalAlignment="Center" />
                        <UniformGrid Columns="5"
                                     Margin="8,0,0,0">
                            <RadioButton Content="AirFiber"
                                         GroupName="TechGroup"
                                         IsChecked="{Binding Technology, Converter={StaticResource EqualsToBool}, ConverterParameter='AirFiber'}" />
                            <RadioButton Content="AirFiber X"
                                         GroupName="TechGroup"
                                         IsChecked="{Binding Technology, Converter={StaticResource EqualsToBool}, ConverterParameter='AirFiber X'}" />
                            <RadioButton Content="AirFiber FX"
                                         GroupName="TechGroup"
                                         IsChecked="{Binding Technology, Converter={StaticResource EqualsToBool}, ConverterParameter='AirFiber FX'}" />
                            <RadioButton Content="AirMax"
                                         GroupName="TechGroup"
                                         IsChecked="{Binding Technology, Converter={StaticResource EqualsToBool}, ConverterParameter='AirMax'}" />
                            <RadioButton Content="AirMax AC"
                                         GroupName="TechGroup"
                                         IsChecked="{Binding Technology, Converter={StaticResource EqualsToBool}, ConverterParameter='AirMax AC'}" />
                        </UniformGrid>
                    </StackPanel>

                    <!-- Row 4: Channel width -->
                    <StackPanel Orientation="Horizontal"
                                Margin="0,0,0,8">
                        <TextBlock Text="Channel Width:"
                                   Width="90"
                                   VerticalAlignment="Center" />
                        <Slider Minimum="5"
                                Maximum="160"
                                Value="{Binding ChannelWidthMHz, UpdateSourceTrigger=PropertyChanged}"
                                Width="200" />
                        <TextBlock Text="{Binding ChannelWidthMHz, StringFormat={}{0} MHz}"
                                   Margin="8,0,0,0"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                    <!-- Row 4.5: Endpoint heights and DEM folder -->
                    <UniformGrid Columns="3"
                                 Margin="0,0,0,8">
                        <StackPanel Orientation="Horizontal"
                                    Margin="0,0,12,0">
                            <TextBlock Text="AP Height:"
                                       Width="90"
                                       VerticalAlignment="Center" />
                            <TextBox Width="80"
                                     Text="{Binding ApHeightM, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text=" m"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal"
                                    Margin="0,0,12,0">
                            <TextBlock Text="STA Height:"
                                       Width="90"
                                       VerticalAlignment="Center" />
                            <TextBox Width="80"
                                     Text="{Binding StaHeightM, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text=" m"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="DEM Folder:"
                                       Width="90"
                                       VerticalAlignment="Center" />
                            <TextBox Width="250"
                                     Text="{Binding DemFolder, UpdateSourceTrigger=PropertyChanged}"
                                     ToolTip="Path with SRTM .hgt tiles (e.g., N50E030.hgt)" />
                        </StackPanel>
                    </UniformGrid>
                    <!-- Row 4.6: Profile mode switch -->
                    <StackPanel Orientation="Horizontal"
                                Margin="0,0,0,8">
                        <TextBlock Text="Profile Mode:"
                                   Width="90"
                                   VerticalAlignment="Center" />
                        <ComboBox Width="140"
                                  SelectedValue="{Binding ProfileMode}">
                            <ComboBoxItem Content="Precise" />
                            <ComboBoxItem Content="Coarse" />
                        </ComboBox>
                        <TextBlock Text="(Precise = fill between terrain and required)"
                                   Margin="8,0,0,0"
                                   VerticalAlignment="Center"
                                   Foreground="#666" />
                    </StackPanel>
                    <!-- Row 5: Antenna gains -->
                    <UniformGrid Columns="2"
                                 Margin="0,0,0,8">
                        <StackPanel Orientation="Horizontal"
                                    Margin="0,0,12,0">
                            <TextBlock Text="Access Point Gain:"
                                       Width="140"
                                       VerticalAlignment="Center" />
                            <ComboBox Width="260"
                                      ItemsSource="{Binding AntennaCatalog}"
                                      SelectedItem="{Binding SelectedApAntenna}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock>
                                            <Run Text="{Binding Brand}" />
                                            <Run Text=" " />
                                            <Run Text="{Binding Model}" />
                                            <Run Text=" (" />
                                            <Run Text="{Binding Gain_dBi}" />
                                            <Run Text=" dBi)" />
                                        </TextBlock>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <TextBlock Text=" → "
                                       VerticalAlignment="Center" />
                            <TextBlock Text="{Binding ApGainDbi}"
                                       VerticalAlignment="Center" />
                            <TextBlock Text=" dBi"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Station Gain:"
                                       Width="140"
                                       VerticalAlignment="Center" />
                            <ComboBox Width="260"
                                      ItemsSource="{Binding AntennaCatalog}"
                                      SelectedItem="{Binding SelectedStaAntenna}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock>
                                            <Run Text="{Binding Brand}" />
                                            <Run Text=" " />
                                            <Run Text="{Binding Model}" />
                                            <Run Text=" (" />
                                            <Run Text="{Binding Gain_dBi}" />
                                            <Run Text=" dBi)" />
                                        </TextBlock>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <TextBlock Text=" → "
                                       VerticalAlignment="Center" />
                            <TextBlock Text="{Binding StaGainDbi}"
                                       VerticalAlignment="Center" />
                            <TextBlock Text=" dBi"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                    </UniformGrid>

                    <!-- Status line -->
                    <DockPanel Margin="0,4,0,0">
                        <StackPanel Orientation="Horizontal"
                                    DockPanel.Dock="Left"
                                    VerticalAlignment="Center">
                            <Ellipse x:Name="LosDot"
                                     Width="12"
                                     Height="12"
                                     Margin="0,0,6,0"
                                     Fill="Gray"
                                     Stroke="#666"
                                     StrokeThickness="0.5" />
                            <TextBlock x:Name="LosText"
                                       VerticalAlignment="Center" />

                            <TextBlock x:Name="StatusText"
                                       Margin="12,0,0,0"
                                       VerticalAlignment="Center" />
                        </StackPanel>

                        <!-- Radio physics -->
                        <GroupBox Header="Radio/Physics"
                                  Margin="0,8,0,0">
                            <UniformGrid Columns="4"
                                         Margin="8">
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,8,0">
                                    <TextBlock Text="k-factor:"
                                               Width="90"
                                               VerticalAlignment="Center" />
                                    <TextBox Width="80"
                                             Text="{Binding KFactor, UpdateSourceTrigger=PropertyChanged}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,8,0">
                                    <TextBlock Text="Tx AP (dBm):"
                                               Width="90"
                                               VerticalAlignment="Center" />
                                    <TextBox Width="80"
                                             Text="{Binding TxPowerApDbm, UpdateSourceTrigger=PropertyChanged}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,8,0">
                                    <TextBlock Text="Tx STA (dBm):"
                                               Width="90"
                                               VerticalAlignment="Center" />
                                    <TextBox Width="80"
                                             Text="{Binding TxPowerStaDbm, UpdateSourceTrigger=PropertyChanged}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,8,0">
                                    <TextBlock Text="Other losses (dB):"
                                               Width="110"
                                               VerticalAlignment="Center" />
                                    <TextBox Width="80"
                                             Text="{Binding OtherLossesDb, UpdateSourceTrigger=PropertyChanged}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,8,0">
                                    <TextBlock Text="Feed AP (dB):"
                                               Width="90"
                                               VerticalAlignment="Center" />
                                    <TextBox Width="80"
                                             Text="{Binding FeedLossApDb, UpdateSourceTrigger=PropertyChanged}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,8,0">
                                    <TextBlock Text="Feed STA (dB):"
                                               Width="90"
                                               VerticalAlignment="Center" />
                                    <TextBox Width="80"
                                             Text="{Binding FeedLossStaDb, UpdateSourceTrigger=PropertyChanged}" />
                                </StackPanel>
                            </UniformGrid>
                        </GroupBox>

                        <TextBlock Margin="12,0,0,0"
                                   VerticalAlignment="Center">
                            <Run Text="Min actual clearance: " />
                            <Run Text="{Binding MinClearancePctActual, StringFormat={}{0:0.#}}" />
                            <Run Text=" % of R1" />
                        </TextBlock>
                    </DockPanel>

                    <!-- Antenna details -->
                    <GroupBox Header="Selected Antennas"
                              Margin="0,8,0,0">
                        <Grid Margin="8">
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="AP:"
                                       Grid.Row="0"
                                       Grid.Column="0"
                                       VerticalAlignment="Center" />
                            <TextBlock Grid.Row="0"
                                       Grid.Column="1">
                                <Run Text="{Binding SelectedApAntenna.Brand}" /><Run Text=" " />
                                <Run Text="{Binding SelectedApAntenna.Model}" />
                                <Run Text=" — " /><Run Text="{Binding SelectedApAntenna.Type}" /><Run Text=", " />
                                <Run Text="{Binding SelectedApAntenna.Polarization}" />
                                <Run Text=" — " />
                                <Hyperlink NavigateUri="{Binding SelectedApAntenna.Source}"
                                           RequestNavigate="OnAntennaLinkNavigate">
                                    <Run Text="{Binding SelectedApAntenna.Source}" />
                                </Hyperlink>
                            </TextBlock>

                            <TextBlock Text="STA:"
                                       Grid.Row="1"
                                       Grid.Column="0"
                                       VerticalAlignment="Center" />
                            <TextBlock Grid.Row="1"
                                       Grid.Column="1">
                                <Run Text="{Binding SelectedStaAntenna.Brand}" /><Run Text=" " />
                                <Run Text="{Binding SelectedStaAntenna.Model}" />
                                <Run Text=" — " /><Run Text="{Binding SelectedStaAntenna.Type}" /><Run Text=", " />
                                <Run Text="{Binding SelectedStaAntenna.Polarization}" />
                                <Run Text=" — " />
                                <Hyperlink NavigateUri="{Binding SelectedStaAntenna.Source}"
                                           RequestNavigate="OnAntennaLinkNavigate">
                                    <Run Text="{Binding SelectedStaAntenna.Source}" />
                                </Hyperlink>
                            </TextBlock>
                        </Grid>
                    </GroupBox>

                    <!-- DEM tiles scan -->
                    <GroupBox Header="DEM tiles"
                              Margin="0,8,0,0">
                        <DockPanel>
                            <Grid DockPanel.Dock="Top"
                                  Margin="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Button Content="Scan required tiles"
                                        Click="ScanDemTiles_Click"
                                        Grid.Column="0" />
                                <StackPanel Orientation="Horizontal"
                                            Grid.Column="1"
                                            Margin="12,0,0,0"
                                            VerticalAlignment="Center">
                                    <TextBlock Text="margin:"
                                               VerticalAlignment="Center" />
                                    <TextBox Width="30"
                                             Margin="6,0,0,0"
                                             Text="{Binding DemScanMargin, UpdateSourceTrigger=PropertyChanged}" />
                                    <CheckBox Margin="12,0,0,0"
                                              Content="Force dateline wrap"
                                              IsChecked="{Binding ForceDatelineWrap}" />
                                </StackPanel>
                                <TextBlock Text="{Binding DemScanSummary}"
                                           VerticalAlignment="Center"
                                           Grid.Column="3"
                                           HorizontalAlignment="Right" />
                            </Grid>
                            <ListView ItemsSource="{Binding DemScan}"
                                      Margin="8"
                                      Height="140">
                                <ListView.View>
                                    <GridView>
                                        <GridViewColumn Header="Tile"
                                                        DisplayMemberBinding="{Binding Name}"
                                                        Width="80" />
                                        <GridViewColumn Header="Status"
                                                        Width="90">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <Ellipse Width="10"
                                                                 Height="10"
                                                                 Fill="{Binding Exists, Converter={StaticResource BoolToBrush}}"
                                                                 Stroke="#666"
                                                                 StrokeThickness="0.5" />
                                                        <TextBlock Text=" "
                                                                   Width="6" />
                                                        <TextBlock
                                                            Text="{Binding Exists, Converter={StaticResource BoolToStatus}}" />
                                                    </StackPanel>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Path"
                                                        DisplayMemberBinding="{Binding FullPath}"
                                                        Width="400" />
                                    </GridView>
                                </ListView.View>
                            </ListView>
                            <StackPanel Orientation="Horizontal"
                                        Margin="8,0,8,8"
                                        DockPanel.Dock="Bottom">
                                <Button Content="Open folder"
                                        Click="OpenDemFolder_Click" />
                                <Button Content="Copy missing"
                                        Margin="8,0,0,0"
                                        Click="CopyMissingTiles_Click" />
                                <Button Content="Download help"
                                        Margin="8,0,0,0"
                                        Click="ShowDownloadHelp_Click" />
                                <Button Content="Download missing (.hgt)"
                                        Margin="8,0,0,0"
                                        Click="DownloadMissingHgt_Click" />
                            </StackPanel>
                        </DockPanel>
                    </GroupBox>


                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</Window>